<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Skrap by nickdima</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Skrap</h1>
        <p class="header">Easily scrap web pages by providing json recipes</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/nickdima/skrap/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/nickdima/skrap/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/nickdima/skrap">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/nickdima">nickdima</a></p>


      </header>
      <section>
        <h1>
<a name="skrap" class="anchor" href="#skrap"><span class="octicon octicon-link"></span></a>skrap</h1>

<p><strong>Skrap</strong> is a command line utility and node.js module for easily scraping web pages by providing <a href="#create-a-recipe">json recipes</a>.</p>

<h2>
<a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting Started</h2>

<p>Install the module with: <code>npm install skrap</code></p>

<h3>
<a name="use-it-from-the-command-line" class="anchor" href="#use-it-from-the-command-line"><span class="octicon octicon-link"></span></a>Use it from the command line</h3>

<pre><code>skrap recipe.json param1=value param2=value ... [options]
</code></pre>

<h3>
<a name="use-it-in-nodejs" class="anchor" href="#use-it-in-nodejs"><span class="octicon octicon-link"></span></a>Use it in node.js</h3>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">skrap</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'skrap'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">recipePath</span> <span class="o">=</span> <span class="s2">"./recipe.json"</span><span class="p">;</span>

<span class="nx">skrap</span><span class="p">(</span><span class="nx">recipePath</span><span class="p">,</span> <span class="p">{</span><span class="nx">param</span><span class="o">:</span> <span class="s1">'value'</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">})</span>
</pre></div>

<h2>
<a name="documentation" class="anchor" href="#documentation"><span class="octicon octicon-link"></span></a>Documentation</h2>

<h3>
<a name="create-a-recipe" class="anchor" href="#create-a-recipe"><span class="octicon octicon-link"></span></a>Create a recipe</h3>

<p>A recipe is just a JSON file that contains rules for scraping a web page. Here's a simple example:</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
    <span class="nt">"url"</span> <span class="p">:</span> <span class="s2">"http://www.imdb.com/find?q=${movie}&amp;s=tt&amp;ttype=ft&amp;ref_=fn_ft"</span><span class="p">,</span>
    <span class="nt">"collections"</span> <span class="p">:</span> <span class="p">[{</span>
        <span class="nt">"name"</span> <span class="p">:</span> <span class="s2">"movies"</span><span class="p">,</span>
        <span class="nt">"query"</span><span class="p">:</span> <span class="s2">"$('table.findList tr')"</span><span class="p">,</span>
        <span class="nt">"fields"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"title"</span> <span class="p">:</span> <span class="s2">"find('td.result_text a').text()"</span><span class="p">,</span>
            <span class="nt">"year"</span> <span class="p">:</span> <span class="s2">"find('td.result_text').text().match(/\\((\\d{4})\\)/)[1]"</span><span class="p">,</span>
            <span class="nt">"poster"</span> <span class="p">:</span> <span class="s2">"find('td.primary_photo img').attr('src')"</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}]</span>
<span class="p">}</span>
</pre></div>

<p>The recipe makes use of CSS selectors for targeting the pieces of data that needs to be scraped. <strong>Skrap</strong> depends on the <a href="https://github.com/MatthewMueller/cheerio"><code>cheerio</code></a> node.js module for querying the DOM, which <a href="https://github.com/MatthewMueller/cheerio#selectors">selector's implementation</a> is nearly identical to jQuery's, so the API is very similar.</p>

<h4>
<a name="brakedown-of-a-simple-recipe-file" class="anchor" href="#brakedown-of-a-simple-recipe-file"><span class="octicon octicon-link"></span></a>Brakedown of a simple recipe file</h4>

<ul>
<li>
<code>url</code> - the url of the page that needs to pe scraped, can contain multiple placeholders in the form of <code>${param_name}</code> for paramters that can be passed from the command line or programtically in node.js</li>
<li>
<code>collections</code> - an array of objects that describe one or more collections (lists of data) to be parsed from the page

<ul>
<li>
<code>name</code> - the collection's name for grouping the results in the output</li>
<li>
<code>query</code> - the selector function that should return an array of objects from which to build the collection</li>
<li>
<code>fields</code> - pairs of data field names and function calls to be applied on the queried objects for retriving the pieces of data needed</li>
</ul>
</li>
</ul><p>Running <code>skrap</code> with the above example and passing the parameter <code>movie=spider-man</code> will generate <a href="https://gist.github.com/nickdima/8898038">this JSON file</a></p>

<h4>
<a name="page-crawling-and-advanced-options" class="anchor" href="#page-crawling-and-advanced-options"><span class="octicon octicon-link"></span></a>Page crawling and advanced options</h4>

<p>Here's a more complex example:</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
    <span class="nt">"url"</span> <span class="p">:</span> <span class="s2">"http://www.imdb.com/find?q=${movie}&amp;s=tt&amp;ttype=ft&amp;ref_=fn_ft"</span><span class="p">,</span>
    <span class="nt">"headers"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"Accept-Language"</span><span class="p">:</span> <span class="s2">"en-US,en;q=0.8,it;q=0.6,ro;q=0.4"</span>
    <span class="p">},</span>
    <span class="nt">"collections"</span> <span class="p">:</span> <span class="p">[{</span>
        <span class="nt">"name"</span> <span class="p">:</span> <span class="s2">"movies"</span><span class="p">,</span>
        <span class="nt">"query"</span><span class="p">:</span> <span class="s2">"$('table.findList tr')"</span><span class="p">,</span>
        <span class="nt">"fields"</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">"title"</span> <span class="p">:</span> <span class="s2">"find('td.result_text a').text()"</span><span class="p">,</span>
            <span class="nt">"year"</span> <span class="p">:</span> <span class="s2">"find('td.result_text').text().match(/\\((\\d{4})\\)/)[1]"</span><span class="p">,</span>
            <span class="nt">"poster"</span> <span class="p">:</span> <span class="s2">"find('td.primary_photo img').attr('src')"</span><span class="p">,</span>
            <span class="nt">"details"</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">"url"</span> <span class="p">:</span> <span class="s2">"find('td.result_text a').attr('href').replace('/','http://www.imdb.com/')"</span><span class="p">,</span>
                <span class="nt">"group"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="nt">"fields"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">"rating"</span><span class="p">:</span> <span class="s2">"$('#overview-top .star-box-giga-star').text().trim()"</span><span class="p">,</span>
                    <span class="nt">"duration"</span><span class="p">:</span> <span class="s2">"$('#overview-top time').text().trim()"</span>             
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}]</span>
<span class="p">}</span>
</pre></div>

<p><strong>Optional fields:</strong></p>

<ul>
<li>
<code>headers</code> - key, value pairs of http headers to be passed when making the requests for the pages to be scraped</li>
</ul><p><strong>Page crawling</strong></p>

<p><strong>Skrap</strong> has basic support for one level deep page crawling. The way it works is by provinding an object with crawling instructions instead of just a selector for a field name.</p>

<ul>
<li>
<code>url</code> - the url of the page that needs to be crawled, a function call simmilar to the ones for retriving the pieces of data</li>
<li>
<code>group</code> - a boolean value for specifing if the crawled data should be grouped under an object (using the parent field name) or attached to the main object. Defaults to <code>true</code>
</li>
<li>
<code>fields</code> - pairs of data field names and selector functions for retriving the pieces of data needed</li>
</ul><p>In cases when you need to crawl a page for just a single piece of data, there's also a simplified syntax:</p>

<div class="highlight highlight-json"><pre><span class="s2">"rating"</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">"url"</span> <span class="p">:</span> <span class="s2">"find('td.result_text a').attr('href').replace('/','http://www.imdb.com/')"</span><span class="p">,</span>
    <span class="nt">"query"</span><span class="p">:</span> <span class="s2">"$('#overview-top .star-box-giga-star').text().trim()"</span>
<span class="p">}</span>
</pre></div>

<h2>
<a name="examples" class="anchor" href="#examples"><span class="octicon octicon-link"></span></a>Examples</h2>

<p>See the <a href="https://github.com/nickdima/skrap/tree/master/examples">/examples</a> folder</p>

<h2>
<a name="contributing" class="anchor" href="#contributing"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>In lieu of a formal styleguide, take care to maintain the existing coding style.</p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>Copyright (c) 2014 Nick Dima<br>
Licensed under the MIT license.</p>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		          <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-47905952-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
